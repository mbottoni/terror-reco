{% extends "_base.html" %}

{% block title %}TerrorReco â€” Horror Movie Recommendations{% endblock %}

{% block nav_right %}
{% if user %}
  <span class="user-email">{{ user.email }}</span>
  <form action="/auth/logout" method="post" style="display:inline">
    <button type="submit" class="btn-signout">Sign out</button>
  </form>
{% else %}
  <a href="/auth/login" class="btn btn-ghost btn-sm">Log in</a>
  <a href="/auth/register" class="btn btn-sm">Sign up</a>
{% endif %}
{% endblock %}

{% block content %}
<div class="container">
  <section class="hero">
    <h1 class="hero-title">Find your next<br><span class="accent">horror</span> movie</h1>
    <p class="hero-sub">Describe a mood and we'll summon terrifying picks.</p>

    <div class="mood-chips">
      <button type="button" class="mood-chip" onclick="pickMood('A fun movie with a lot of blood')"><span class="chip-icon">ðŸ©¸</span> Bloody fun</button>
      <button type="button" class="mood-chip" onclick="pickMood('Supernatural hauntings with ghosts')"><span class="chip-icon">ðŸ‘»</span> Ghost hauntings</button>
      <button type="button" class="mood-chip" onclick="pickMood('Mind-bending psychological horror')"><span class="chip-icon">ðŸ§ </span> Psychological</button>
      <button type="button" class="mood-chip" onclick="pickMood('Zombie apocalypse survival')"><span class="chip-icon">ðŸ§Ÿ</span> Zombie survival</button>
      <button type="button" class="mood-chip" onclick="pickMood('Classic slasher with suspense')"><span class="chip-icon">ðŸ”ª</span> Slasher</button>
    </div>

    <form action="/loading" method="get" id="search-form">
      <div class="search-wrap">
        <div class="search-bar">
          <input id="mood" name="mood" type="text" placeholder="Describe a vibe... e.g. haunted house with a dark secret" required autocomplete="off">
          <button type="submit" class="btn btn-primary">Recommend</button>
        </div>
      </div>

      <div class="filters-row">
        <button type="button" class="filters-toggle" id="filters-btn" aria-expanded="false" onclick="toggleFilters()">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd"/></svg>
          Advanced filters
        </button>
        <div class="filters-panel collapsed" id="filters-panel">
          <div class="filter-group">
            <label for="min_year">Min year</label>
            <input id="min_year" name="min_year" type="number" min="1900" max="2100" placeholder="1970">
          </div>
          <div class="filter-group">
            <label for="max_year">Max year</label>
            <input id="max_year" name="max_year" type="number" min="1900" max="2100" placeholder="2025">
          </div>
          <div class="filter-group">
            <label for="limit">Results</label>
            <input id="limit" name="limit" type="number" min="1" max="20" value="6">
          </div>
          <div class="filter-group">
            <label for="kind">Type</label>
            <select id="kind" name="kind">
              <option value="movie" selected>Movies</option>
              <option value="series">Series</option>
              <option value="both">Both</option>
            </select>
          </div>
          <div class="filter-checkbox">
            <input id="english" name="english" type="checkbox" value="1">
            <label for="english">English only</label>
          </div>
        </div>
      </div>
    </form>
  </section>

  <hr class="divider">
  <p style="text-align:center;padding-bottom:20px">
    <a href="/stripe/coffee" class="coffee-link">â˜• Buy me a coffee</a>
  </p>
</div>
{% endblock %}

{% block scripts %}
<script>
function pickMood(v){
  document.getElementById('mood').value=v;
  document.getElementById('search-form').submit();
}
function toggleFilters(){
  var p=document.getElementById('filters-panel');
  var b=document.getElementById('filters-btn');
  var open=b.getAttribute('aria-expanded')==='true';
  p.classList.toggle('collapsed');
  b.setAttribute('aria-expanded',String(!open));
}
</script>
{% endblock %}
