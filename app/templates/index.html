{% extends "_base.html" %}

{% block title %}TerrorReco â€” Horror Movie Recommendations{% endblock %}

{% block nav_right %}
{% if user %}
  <div class="avatar-wrap">
    <button type="button" class="avatar-btn" id="avatar-btn" aria-expanded="false" onclick="toggleAvatar()">{{ user.email[0] }}</button>
    <div class="avatar-menu" id="avatar-menu">
      <div class="avatar-menu-header">
        <div class="avatar-menu-label">Signed in as</div>
        <div class="avatar-menu-email">{{ user.email }}</div>
      </div>
      <a href="/history/" class="avatar-menu-item">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16Zm.75-13a.75.75 0 0 0-1.5 0v5c0 .414.336.75.75.75h4a.75.75 0 0 0 0-1.5h-3.25V5Z" clip-rule="evenodd"/></svg>
        Search history
      </a>
      <form action="/auth/logout" method="post">
        <button type="submit" class="avatar-menu-item" style="color:#fca5a5">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 4.25A2.25 2.25 0 0 1 5.25 2h5.5A2.25 2.25 0 0 1 13 4.25v2a.75.75 0 0 1-1.5 0v-2a.75.75 0 0 0-.75-.75h-5.5a.75.75 0 0 0-.75.75v11.5c0 .414.336.75.75.75h5.5a.75.75 0 0 0 .75-.75v-2a.75.75 0 0 1 1.5 0v2A2.25 2.25 0 0 1 10.75 18h-5.5A2.25 2.25 0 0 1 3 15.75V4.25Z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M19 10a.75.75 0 0 0-.75-.75H8.704l1.048-.943a.75.75 0 1 0-1.004-1.114l-2.5 2.25a.75.75 0 0 0 0 1.114l2.5 2.25a.75.75 0 1 0 1.004-1.114l-1.048-.943h9.546A.75.75 0 0 0 19 10Z" clip-rule="evenodd"/></svg>
          Sign out
        </button>
      </form>
    </div>
  </div>
{% else %}
  <a href="/auth/login" class="btn btn-ghost btn-sm">Log in</a>
  <a href="/auth/register" class="btn btn-sm">Sign up</a>
{% endif %}
{% endblock %}

{% block content %}
<div class="container">
  <section class="hero">
    <h1 class="hero-title">Find your next<br><span class="accent">horror</span> movie</h1>
    <p class="hero-sub">Describe a mood and we'll summon terrifying picks.</p>

    <div class="mood-chips">
      <button type="button" class="mood-chip" onclick="pickMood('A fun movie with a lot of blood')"><span class="chip-icon">ðŸ©¸</span> Bloody fun</button>
      <button type="button" class="mood-chip" onclick="pickMood('Supernatural hauntings with ghosts')"><span class="chip-icon">ðŸ‘»</span> Ghost hauntings</button>
      <button type="button" class="mood-chip" onclick="pickMood('Mind-bending psychological horror')"><span class="chip-icon">ðŸ§ </span> Psychological</button>
      <button type="button" class="mood-chip" onclick="pickMood('Zombie apocalypse survival')"><span class="chip-icon">ðŸ§Ÿ</span> Zombie survival</button>
      <button type="button" class="mood-chip" onclick="pickMood('Classic slasher with suspense')"><span class="chip-icon">ðŸ”ª</span> Slasher</button>
    </div>

    <form action="/loading" method="get" id="search-form">
      <div class="search-wrap">
        <div class="search-bar">
          <input id="mood" name="mood" type="text" placeholder="Describe a vibe... e.g. haunted house with a dark secret" required autocomplete="off">
          <button type="submit" class="btn btn-primary">Recommend</button>
        </div>
      </div>

      <div class="strategy-row">
        <label class="strategy-label" for="strategy">
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M15.312 11.424a5.5 5.5 0 0 1-9.201 2.466l-.312-.311h2.433a.75.75 0 0 0 0-1.5H4.598a.75.75 0 0 0-.75.75v3.634a.75.75 0 0 0 1.5 0v-2.033l.312.311a7 7 0 0 0 11.712-3.138.75.75 0 0 0-1.449-.39Zm-10.624-2.85a5.5 5.5 0 0 1 9.201-2.465l.312.31H11.77a.75.75 0 0 0 0 1.5h3.634a.75.75 0 0 0 .75-.75V3.535a.75.75 0 0 0-1.5 0v2.033l-.311-.311A7 7 0 0 0 2.63 8.395a.75.75 0 0 0 1.45.39Z" clip-rule="evenodd"/></svg>
          Strategy
        </label>
        <select id="strategy" name="strategy" class="strategy-select">
          <option value="semantic" selected>Semantic Search</option>
          <option value="unified">Unified (AI + Diversity)</option>
          <option value="embedding">TF-IDF Similarity</option>
          <option value="keyword">Keyword Match</option>
        </select>
      </div>

      <div class="filters-row">
        <button type="button" class="filters-toggle" id="filters-btn" aria-expanded="false" onclick="toggleFilters()">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd"/></svg>
          Advanced filters
        </button>
        <div class="filters-panel collapsed" id="filters-panel">
          <div class="filter-group">
            <label for="min_year">Min year</label>
            <input id="min_year" name="min_year" type="number" min="1900" max="2100" placeholder="1970">
          </div>
          <div class="filter-group">
            <label for="max_year">Max year</label>
            <input id="max_year" name="max_year" type="number" min="1900" max="2100" placeholder="2025">
          </div>
          <div class="filter-group">
            <label for="limit">Results</label>
            <input id="limit" name="limit" type="number" min="1" max="20" value="6">
          </div>
          <div class="filter-group">
            <label for="kind">Type</label>
            <select id="kind" name="kind">
              <option value="movie" selected>Movies</option>
              <option value="series">Series</option>
              <option value="both">Both</option>
            </select>
          </div>
          <div class="filter-checkbox">
            <input id="english" name="english" type="checkbox" value="1">
            <label for="english">English only</label>
          </div>
        </div>
      </div>
    </form>
  </section>

  <hr class="divider">
  <p style="text-align:center;padding-bottom:20px">
    <a href="/stripe/coffee" class="coffee-link">â˜• Buy me a coffee</a>
  </p>
</div>
{% endblock %}

{% block scripts %}
<script>
function pickMood(v){
  document.getElementById('mood').value=v;
  document.getElementById('search-form').submit();
}
function toggleFilters(){
  var p=document.getElementById('filters-panel');
  var b=document.getElementById('filters-btn');
  var open=b.getAttribute('aria-expanded')==='true';
  p.classList.toggle('collapsed');
  b.setAttribute('aria-expanded',String(!open));
}
function toggleAvatar(){
  var m=document.getElementById('avatar-menu');
  var b=document.getElementById('avatar-btn');
  var open=m.classList.toggle('open');
  b.setAttribute('aria-expanded',String(open));
}
// Close menu when clicking outside
document.addEventListener('click',function(e){
  var wrap=document.querySelector('.avatar-wrap');
  if(wrap && !wrap.contains(e.target)){
    document.getElementById('avatar-menu')?.classList.remove('open');
    document.getElementById('avatar-btn')?.setAttribute('aria-expanded','false');
  }
});
</script>
{% endblock %}
