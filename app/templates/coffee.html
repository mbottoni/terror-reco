{% extends "_base.html" %}

{% block title %}Support TerrorReco{% endblock %}

{% block head %}
<script src="https://js.stripe.com/v3/"></script>
{% endblock %}

{% block content %}
<div class="support-card">
  <div class="support-icon">☕</div>
  <h1 class="support-title">Buy me a coffee</h1>
  <p class="support-desc">
    Enjoying TerrorReco? Your support helps keep the spooky recommendations
    coming and lets me keep improving this project.
  </p>
  <button id="coffee-button" class="btn-coffee">☕ Support with $3</button>
</div>
{% endblock %}

{% block scripts %}
<script>
var stripe=Stripe('{{ stripe_publishable_key }}');
var btn=document.getElementById('coffee-button');
btn.addEventListener('click',async function(){
  btn.disabled=true;btn.textContent='Processing…';
  try{
    var res=await fetch('/stripe/create-checkout-session',{method:'POST',headers:{'Content-Type':'application/json'}});
    var data=await res.json();
    if(data.checkout_url)window.location.href=data.checkout_url;
    else throw new Error('No checkout URL');
  }catch(e){
    console.error(e);alert('Something went wrong. Please try again.');
    btn.disabled=false;btn.textContent='☕ Support with $3';
  }
});
</script>
{% endblock %}
