<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>{% block title %}TerrorReco{% endblock %}</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
{% block head %}{% endblock %}
<style>
/* ---- RESET ---- */
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{font-size:16px;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
body{font-family:'Inter',system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:#0b0b0f;color:#e8e8ec;line-height:1.6;min-height:100vh}
a{color:inherit;text-decoration:none}
ul,ol{list-style:none}
img{display:block;max-width:100%}

/* Aggressive form reset */
button,input,select,textarea{
  font-family:inherit;font-size:inherit;color:inherit;
  -webkit-appearance:none;-moz-appearance:none;appearance:none;
  background:none;border:none;outline:none;
}
button{cursor:pointer}
select{cursor:pointer}

/* ---- LAYOUT ---- */
.page-wrap{display:flex;flex-direction:column;min-height:100vh}
.page-main{flex:1}
.container{max-width:960px;margin:0 auto;padding:0 24px}

/* ---- NAV ---- */
.nav{
  position:sticky;top:0;z-index:100;
  background:rgba(11,11,15,.88);
  backdrop-filter:saturate(180%) blur(20px);
  -webkit-backdrop-filter:saturate(180%) blur(20px);
  border-bottom:1px solid rgba(255,255,255,.07);
}
.nav-inner{
  max-width:960px;margin:0 auto;padding:0 24px;
  display:flex;align-items:center;height:60px;gap:0;
}
.nav-brand{
  font-weight:900;font-size:1.125rem;letter-spacing:-.04em;
  color:#e8e8ec;margin-right:32px;flex-shrink:0;
}
.nav-brand em{font-style:normal;color:#e03131}
.nav-links{display:flex;align-items:center;gap:24px}
.nav-links a{font-size:.875rem;font-weight:500;color:#6b6b78;transition:color .15s}
.nav-links a:hover{color:#e8e8ec}
.nav-right{margin-left:auto;display:flex;align-items:center;gap:12px;font-size:.875rem}
.nav-right .user-email{color:#6b6b78}

/* ---- BUTTONS ---- */
.btn{
  display:inline-flex;align-items:center;justify-content:center;gap:8px;
  padding:10px 22px;border-radius:10px;
  font-weight:700;font-size:.875rem;white-space:nowrap;
  transition:all .2s ease;
  background:#222228;color:#a0a0ad;border:1px solid #333340;
}
.btn:hover{background:#2c2c34;color:#e8e8ec;border-color:#46464f}
.btn-primary{background:#d32f2f;color:#fff;border:none;box-shadow:0 0 24px rgba(211,47,47,.2)}
.btn-primary:hover{background:#e53935;color:#fff;box-shadow:0 0 32px rgba(211,47,47,.3);transform:translateY(-1px)}
.btn-sm{padding:6px 14px;font-size:.8125rem}
.btn-ghost{background:transparent;color:#6b6b78;border:none;padding:8px 14px}
.btn-ghost:hover{color:#e8e8ec}
.btn-signout{
  background:transparent;color:#6b6b78;
  border:1px solid #333340;border-radius:8px;
  padding:5px 14px;font-size:.8125rem;font-weight:600;
  cursor:pointer;transition:all .15s;width:100%;text-align:left;
}
.btn-signout:hover{border-color:#555;color:#a0a0ad}

/* ---- AVATAR / PROFILE MENU ---- */
.avatar-wrap{position:relative}
.avatar-btn{
  width:36px;height:36px;border-radius:50%;
  background:#e03131;color:#fff;
  display:flex;align-items:center;justify-content:center;
  font-weight:800;font-size:.8125rem;letter-spacing:.02em;
  cursor:pointer;border:2px solid transparent;
  transition:border-color .15s,box-shadow .15s;
  text-transform:uppercase;flex-shrink:0;
}
.avatar-btn:hover,.avatar-btn[aria-expanded="true"]{
  border-color:rgba(224,49,49,.4);
  box-shadow:0 0 0 3px rgba(224,49,49,.15);
}
.avatar-menu{
  position:absolute;right:0;top:calc(100% + 8px);
  min-width:220px;
  background:#16161c;border:1px solid #2a2a33;border-radius:12px;
  padding:6px;
  box-shadow:0 12px 40px rgba(0,0,0,.5);
  opacity:0;visibility:hidden;transform:translateY(-4px);
  transition:opacity .15s ease,transform .15s ease,visibility .15s;
  z-index:200;
}
.avatar-menu.open{opacity:1;visibility:visible;transform:translateY(0)}
.avatar-menu-header{padding:12px 14px 10px;border-bottom:1px solid #2a2a33;margin-bottom:4px}
.avatar-menu-label{font-size:.7rem;font-weight:700;color:#555566;text-transform:uppercase;letter-spacing:.06em}
.avatar-menu-email{font-size:.8125rem;color:#e8e8ec;font-weight:600;margin-top:2px;word-break:break-all}
.avatar-menu-item{
  display:flex;align-items:center;gap:10px;
  width:100%;padding:10px 14px;border-radius:8px;
  font-size:.8125rem;font-weight:600;color:#9c9caa;
  transition:background .12s,color .12s;
  background:none;border:none;cursor:pointer;text-align:left;
}
.avatar-menu-item:hover{background:#1e1e26;color:#e8e8ec}
.avatar-menu-item svg{width:16px;height:16px;opacity:.6;flex-shrink:0}

/* ---- FLASH ---- */
.flash{
  padding:14px 20px;border-radius:10px;
  background:rgba(52,211,153,.1);border:1px solid rgba(52,211,153,.25);
  color:#6ee7b7;font-size:.875rem;font-weight:600;
  margin-bottom:24px;transition:opacity .4s,transform .4s;
  display:flex;align-items:center;gap:10px;
}
.flash::before{content:'✓';font-size:1.1rem}
.flash-error{
  background:rgba(239,68,68,.1);border:1px solid rgba(239,68,68,.25);
  color:#fca5a5;
}
.flash-error::before{content:'!';display:inline-flex;align-items:center;justify-content:center;width:20px;height:20px;border-radius:50%;background:rgba(239,68,68,.2);font-size:.75rem;font-weight:800;flex-shrink:0}

/* ---- HERO (HOME) ---- */
.hero{padding:64px 0 48px;text-align:center}
.hero-title{
  font-size:clamp(2rem,5vw,3.25rem);
  font-weight:900;letter-spacing:-.05em;line-height:1.1;
  margin-bottom:12px;color:#fff;
}
.hero-title .accent{color:#e03131}
.hero-sub{color:#6b6b78;font-size:1.1rem;max-width:440px;margin:0 auto 40px;line-height:1.5}

/* ---- MOOD CHIPS ---- */
.mood-chips{display:flex;flex-wrap:wrap;justify-content:center;gap:10px;margin-bottom:36px}
.mood-chip{
  display:inline-flex;align-items:center;gap:7px;
  background:#16161c;border:1px solid #2a2a33;color:#9c9caa;
  padding:9px 18px;border-radius:999px;
  font-size:.8125rem;font-weight:600;
  transition:all .2s ease;cursor:pointer;
}
.mood-chip:hover{
  background:#1e1e26;border-color:#444;color:#e8e8ec;
  transform:translateY(-2px);box-shadow:0 6px 20px rgba(0,0,0,.4);
}
.mood-chip .chip-icon{font-size:.95rem;line-height:1}

/* ---- SEARCH BAR ---- */
.search-wrap{max-width:620px;margin:0 auto 14px}
.search-bar{
  display:flex;align-items:center;gap:8px;
  background:#141419;border:2px solid #2a2a33;
  border-radius:14px;padding:6px 6px 6px 20px;
  transition:border-color .2s,box-shadow .2s;
}
.search-bar:focus-within{
  border-color:#e03131;
  box-shadow:0 0 0 4px rgba(224,49,49,.12),0 8px 32px rgba(0,0,0,.3);
}
.search-bar input[type="text"]{
  flex:1;background:transparent !important;border:none !important;outline:none !important;
  color:#e8e8ec;font-size:1rem;padding:10px 0;
  -webkit-appearance:none !important;
}
.search-bar input[type="text"]::placeholder{color:#555566}

/* ---- FILTERS ---- */
.filters-row{max-width:620px;margin:0 auto;text-align:left}
.filters-toggle{
  display:inline-flex;align-items:center;gap:6px;
  color:#555566;font-size:.8125rem;font-weight:600;
  padding:6px 0;transition:color .15s;background:none !important;border:none !important;
}
.filters-toggle:hover{color:#9c9caa}
.filters-toggle svg{width:16px;height:16px;transition:transform .25s}
.filters-toggle[aria-expanded="true"] svg{transform:rotate(180deg)}
.filters-panel{
  display:grid;grid-template-columns:repeat(5,1fr);gap:12px;
  margin-top:14px;max-height:200px;opacity:1;
  overflow:hidden;transition:max-height .3s ease,opacity .25s ease,margin .3s ease;
}
.filters-panel.collapsed{max-height:0 !important;opacity:0 !important;margin-top:0 !important;pointer-events:none}

.filter-group label{
  display:block;font-size:.7rem;font-weight:700;color:#555566;
  text-transform:uppercase;letter-spacing:.08em;margin-bottom:6px;
}
.filter-group input[type="number"],
.filter-group select{
  width:100%;padding:9px 12px;border-radius:8px;
  border:1px solid #2a2a33 !important;background:#141419 !important;
  color:#e8e8ec !important;font-size:.8125rem;
  -webkit-appearance:none !important;-moz-appearance:none !important;appearance:none !important;
  transition:border-color .15s;
}
.filter-group input:focus,
.filter-group select:focus{border-color:#555 !important}
.filter-group select{
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10' fill='%236b6b78' viewBox='0 0 16 16'%3E%3Cpath d='M8 12L2 6h12z'/%3E%3C/svg%3E") !important;
  background-repeat:no-repeat !important;background-position:right 12px center !important;
  padding-right:32px;
}
.filter-checkbox{display:flex;align-items:center;gap:8px;padding-top:22px}
.filter-checkbox input[type="checkbox"]{
  width:18px;height:18px;border:2px solid #2a2a33;border-radius:4px;
  background:#141419;cursor:pointer;
  -webkit-appearance:none !important;appearance:none !important;
  display:grid;place-content:center;
}
.filter-checkbox input[type="checkbox"]:checked{background:#d32f2f;border-color:#d32f2f}
.filter-checkbox input[type="checkbox"]:checked::before{
  content:"✓";color:#fff;font-size:12px;font-weight:700;
}
.filter-checkbox label{
  font-size:.8125rem;color:#9c9caa;cursor:pointer;
  text-transform:none;letter-spacing:0;margin:0;
}

/* ---- MOVIE CARD GRID ---- */
.grid{
  display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:20px;
}
.card{
  background:#141419;border-radius:12px;overflow:hidden;
  border:1px solid transparent;
  transition:transform .3s ease,border-color .3s ease,box-shadow .3s ease;
}
.card:hover{
  transform:translateY(-6px);border-color:#333340;
  box-shadow:0 20px 50px rgba(0,0,0,.6);
}
.card-poster{width:100%;aspect-ratio:2/3;object-fit:cover;background:#1a1a22}
.card-no-poster{
  width:100%;aspect-ratio:2/3;background:#1a1a22;
  display:flex;align-items:center;justify-content:center;
  color:#333340;font-size:3rem;
}
.card-body{padding:14px 16px 18px}
.card-title{font-size:.9rem;font-weight:700;line-height:1.3;margin-bottom:6px;color:#e8e8ec}
.card-meta{display:flex;align-items:center;gap:8px;font-size:.75rem;color:#6b6b78;margin-bottom:8px}
.card-meta .rating{color:#f5c518;font-weight:700}
.card-overview{
  font-size:.8rem;color:#8b8b96;line-height:1.55;
  display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden;
}

/* ---- RESULTS PAGE ---- */
.results-header{margin-bottom:28px}
.results-mood{color:#6b6b78;font-size:.9rem;margin-top:4px}
.results-mood em{color:#9c9caa;font-style:normal;font-weight:600}
.back-link{
  display:inline-flex;align-items:center;gap:6px;
  color:#6b6b78;font-size:.875rem;font-weight:600;
  margin-bottom:24px;transition:color .15s;
}
.back-link:hover{color:#e8e8ec}
.page-title{font-size:1.75rem;font-weight:900;letter-spacing:-.04em;line-height:1.2;margin-bottom:4px;color:#fff}
.page-subtitle{color:#6b6b78;font-size:1rem;margin-bottom:28px}

/* ---- AUTH PAGES ---- */
.auth-wrapper{max-width:400px;margin:56px auto}
.auth-card{background:#141419;border:1px solid #2a2a33;border-radius:16px;padding:40px 32px}
.auth-title{font-size:1.5rem;font-weight:900;text-align:center;margin-bottom:32px;color:#fff;letter-spacing:-.03em}
.auth-form .form-group{margin-bottom:18px}
.auth-form label{display:block;font-size:.8rem;font-weight:700;color:#6b6b78;margin-bottom:8px}
.auth-form input[type="email"],
.auth-form input[type="password"]{
  width:100%;padding:12px 16px;border-radius:10px;
  border:2px solid #2a2a33 !important;background:#0b0b0f !important;
  color:#e8e8ec !important;font-size:.95rem;
  -webkit-appearance:none !important;
  transition:border-color .15s,box-shadow .15s;
}
.auth-form input:focus{
  border-color:#e03131 !important;
  box-shadow:0 0 0 4px rgba(224,49,49,.1) !important;
}
.auth-form input::placeholder{color:#444455}
.auth-form .btn{width:100%;margin-top:8px;padding:13px;font-size:.95rem}
.auth-footer{text-align:center;margin-top:24px;font-size:.8125rem;color:#555566}
.auth-footer a{color:#9c9caa;font-weight:700;transition:color .15s}
.auth-footer a:hover{color:#e8e8ec}
.auth-brand{text-align:center;margin-bottom:8px;font-size:1.25rem;font-weight:900;letter-spacing:-.04em}
.auth-brand em{font-style:normal;color:#e03131}
.auth-subtitle{text-align:center;color:#555566;font-size:.8125rem;margin-bottom:28px}
.auth-divider{display:flex;align-items:center;gap:12px;margin:20px 0}
.auth-divider::before,.auth-divider::after{content:'';flex:1;height:1px;background:#2a2a33}
.auth-divider span{color:#555566;font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.06em}
.form-group{position:relative}
.input-wrap{position:relative}
.input-wrap input{padding-right:48px !important}
.pw-toggle{
  position:absolute;right:12px;top:50%;transform:translateY(-50%);
  background:none !important;border:none !important;color:#555566;
  padding:4px;cursor:pointer;display:flex;align-items:center;justify-content:center;
  transition:color .15s;
}
.pw-toggle:hover{color:#9c9caa}
.pw-toggle svg{width:20px;height:20px}
.pw-hint{font-size:.75rem;color:#555566;margin-top:6px}
.pw-strength{height:3px;border-radius:2px;background:#2a2a33;margin-top:8px;overflow:hidden}
.pw-strength-bar{height:100%;border-radius:2px;width:0;transition:width .3s ease,background .3s ease}
.pw-strength-bar.weak{width:33%;background:#ef4444}
.pw-strength-bar.medium{width:66%;background:#f59e0b}
.pw-strength-bar.strong{width:100%;background:#22c55e}
.pw-strength-label{font-size:.7rem;font-weight:600;margin-top:4px;transition:color .2s}
.pw-strength-label.weak{color:#ef4444}
.pw-strength-label.medium{color:#f59e0b}
.pw-strength-label.strong{color:#22c55e}
.btn-loading{pointer-events:none;opacity:.7}
.btn-loading .btn-text{visibility:hidden}
.btn-loading .btn-spinner{position:absolute}
.btn-spinner{display:none}
.btn-loading .btn-spinner{display:block}
.spinner{width:20px;height:20px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:spin .6s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.auth-form .btn{position:relative;display:flex;align-items:center;justify-content:center}
.form-error{font-size:.75rem;color:#fca5a5;margin-top:6px;display:none}
.form-group.has-error input{border-color:#ef4444 !important}
.form-group.has-error .form-error{display:block}

/* ---- HISTORY ---- */
.history-list{display:flex;flex-direction:column;gap:8px}
.history-item{
  background:#141419;border:1px solid #2a2a33;border-radius:10px;
  padding:16px 20px;display:flex;align-items:center;justify-content:space-between;
  transition:border-color .2s,background .2s;
}
.history-item:hover{background:#1a1a22;border-color:#444}
.history-mood{font-weight:600;color:#e8e8ec}
.history-date{font-size:.8rem;color:#555566}

/* ---- SUPPORT / COFFEE ---- */
.support-card{
  max-width:460px;margin:56px auto;text-align:center;
  background:#141419;border:1px solid #2a2a33;border-radius:20px;padding:52px 36px;
}
.support-icon{font-size:3.5rem;margin-bottom:20px}
.support-title{font-size:1.75rem;font-weight:900;margin-bottom:12px;color:#fff;letter-spacing:-.03em}
.support-desc{color:#6b6b78;font-size:.95rem;line-height:1.65;margin-bottom:32px}
.btn-coffee{
  background:linear-gradient(135deg,#ea580c,#fb923c);color:#fff;
  border:none;padding:14px 32px;border-radius:12px;font-size:1rem;font-weight:800;
  display:inline-flex;align-items:center;gap:8px;
  transition:transform .2s,box-shadow .2s;cursor:pointer;
}
.btn-coffee:hover{transform:translateY(-2px);box-shadow:0 12px 32px rgba(234,88,12,.25);color:#fff}
.btn-coffee:disabled{opacity:.5;cursor:not-allowed;transform:none;box-shadow:none}

/* ---- STATUS PAGES ---- */
.status-card{
  max-width:460px;margin:56px auto;text-align:center;
  background:#141419;border:1px solid #2a2a33;border-radius:20px;padding:52px 36px;
}
.status-icon{font-size:4rem;margin-bottom:20px}
.status-title{font-size:1.75rem;font-weight:900;margin-bottom:12px;color:#fff;letter-spacing:-.03em}
.status-title.success{color:#34d399}
.status-title.warning{color:#fbbf24}
.status-desc{color:#6b6b78;font-size:.95rem;line-height:1.65;margin-bottom:28px}
.status-amount{font-size:2.25rem;font-weight:900;color:#fff;margin-bottom:28px}

/* ---- LOADING ---- */
.loading-screen{
  min-height:100vh;display:flex;flex-direction:column;
  align-items:center;justify-content:center;gap:24px;background:#0b0b0f;
}
.loading-screen img{max-width:340px;width:80%;border-radius:16px;box-shadow:0 16px 60px rgba(0,0,0,.7)}
.loading-text{color:#555566;font-size:.95rem;font-weight:600}
.loading-dots::after{content:'';animation:ldots 1.4s steps(4,end) infinite}
@keyframes ldots{0%{content:''}25%{content:'.'}50%{content:'..'}75%{content:'...'}}

/* ---- EMPTY STATE ---- */
.empty-state{text-align:center;padding:56px 16px;color:#555566}
.empty-state-icon{font-size:3rem;margin-bottom:12px;opacity:.6}
.empty-state p{font-size:.95rem}

/* ---- FOOTER ---- */
.site-footer{padding:28px 0;border-top:1px solid rgba(255,255,255,.04)}
.site-footer p{font-size:.8rem;color:#444455;text-align:center}

/* ---- UTILITY ---- */
.divider{height:1px;background:#2a2a33;border:none;margin:36px 0}
.coffee-link{
  display:inline-flex;align-items:center;gap:6px;
  color:#555566;font-size:.8125rem;font-weight:600;transition:color .2s;
}
.coffee-link:hover{color:#fb923c}

/* ---- RESPONSIVE ---- */
@media(max-width:768px){
  .hero{padding:40px 0 32px}
  .filters-panel{grid-template-columns:repeat(2,1fr)}
  .filter-checkbox{padding-top:0}
  .container{padding:0 16px}
  .nav-inner{padding:0 16px}
}
@media(max-width:480px){
  .hero-title{font-size:1.75rem}
  .search-bar{flex-direction:column;padding:12px;gap:10px}
  .search-bar input[type="text"]{padding:8px 4px}
  .search-bar .btn{width:100%}
  .filters-panel{grid-template-columns:1fr}
  .grid{grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:12px}
  .nav-links{gap:14px}
  .mood-chips{gap:6px}
  .mood-chip{font-size:.75rem;padding:7px 12px}
  .auth-card{padding:28px 20px}
  .history-item{flex-direction:column;align-items:flex-start;gap:6px}
}
</style>
</head>
<body>
<div class="page-wrap">

<nav class="nav">
  <div class="nav-inner">
    <a href="/" class="nav-brand">Terror<em>Reco</em></a>
    <div class="nav-links">
      {% block nav_links %}
      <a href="/">Home</a>
      <a href="/history/">History</a>
      {% endblock %}
    </div>
    <div class="nav-right">
      {% block nav_right %}{% endblock %}
    </div>
  </div>
</nav>

<main class="page-main">
  {% block flash_area %}
  {% if flash is defined and flash %}
  <div class="container" style="padding-top:20px">
    <div class="flash{% if flash_type is defined and flash_type == 'error' %} flash-error{% endif %}" id="flash-msg" data-type="{{ flash_type|default('success') }}">{{ flash }}</div>
  </div>
  {% endif %}
  {% endblock %}
  {% block content %}{% endblock %}
</main>

<footer class="site-footer">
  <div class="container">
    <p>TerrorReco &mdash; Horror movie recommendations</p>
  </div>
</footer>

</div>
<script>
(function(){
  var f=document.getElementById('flash-msg');
  if(!f)return;
  // Error flashes stay visible — only auto-hide success messages
  if(f.getAttribute('data-type')==='error')return;
  setTimeout(function(){f.style.opacity='0';f.style.transform='translateY(-8px)';setTimeout(function(){f.remove()},400)},5000);
})();
</script>
{% block scripts %}{% endblock %}
</body>
</html>
